<h1 mat-dialog-title class="text-center">
  {{ title }} Garantía {{ isUpdateMode() ? data.id : "" }}
</h1>

<div class="flex md:justify-evenly my-3">
  <button
    *ngIf="form.controls['doc'].value"
    (click)="verDoc()"
    type="button"
    matButton="tonal"
    color="accent"
  >
    <mat-icon matSuffix>visibility</mat-icon> Ver Documento
  </button>

  <button
    *ngIf="form.controls['telefono'].value"
    (click)="avisar()"
    mat-raised-button
    class="whatsapp-button"
  >
    <mat-icon>phone</mat-icon> Avisar a Cliente
  </button>

  <span *ngIf="form.controls['doc'].value">{{
    form.controls["doc"].value
  }}</span>

  <button
    type="button"
    matButton="outlined"
    (click)="fileInput.click()"
    color="primary"
  >
    <mat-icon matSuffix>upload</mat-icon> Subir Documento
  </button>

  <input hidden type="file" #fileInput (change)="uploadDocumento($event)" />
</div>

<form [formGroup]="form">
  <div mat-dialog-content class="text-center space-y-2">
    <div class="text-center grid grid-rows-1">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <mat-form-field class="w-50 col">
          <mat-label>Folio Servicio</mat-label>
          <input
            formControlName="id_servicio"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-icon matSuffix>tag</mat-icon>
        </mat-form-field>
        <mat-form-field class="w-50 col">
          <mat-label>Número de Traspaso</mat-label>

          <input formControlName="traspaso" matInput type="number" />
          <mat-error *ngIf="form.controls['traspaso'].hasError('required')">
            El número de traspaso es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>attach_money</mat-icon>
        </mat-form-field>
        <mat-form-field class="w-50 col">
          <mat-label>Folio de Ticket o Factura</mat-label>

          <input
            formControlName="folio"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-error *ngIf="form.controls['folio'].hasError('required')">
            El folio es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>tag</mat-icon>
        </mat-form-field>

        <mat-form-field class="col w-50">
          <mat-label>Producto</mat-label>

          <input
            formControlName="producto"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-error *ngIf="form.controls['producto'].hasError('required')">
            El producto es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>inventory_2</mat-icon>
        </mat-form-field>
        <mat-form-field class="col w-50">
          <mat-label>Serie</mat-label>

          <input
            formControlName="serie"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-error *ngIf="form.controls['serie'].hasError('required')">
            El número de serie es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>pin</mat-icon>
        </mat-form-field>
        <mat-form-field class="col w-50">
          <mat-label>Marca</mat-label>
          <input
            formControlName="marca"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-error *ngIf="form.controls['marca'].hasError('required')">
            La marca es <strong> requerida </strong>
          </mat-error>
          <mat-icon matSuffix>bookmark</mat-icon>
        </mat-form-field>
        <mat-form-field class="col w-50">
          <mat-label>Teléfono</mat-label>

          <input
            pattern="^[0-9]*$"
            formControlName="telefono"
            matInput
            type="text"
            maxlength="10"
            minlength="10"
          />
          <mat-icon matSuffix>phone</mat-icon>
        </mat-form-field>

        <mat-form-field class="w-50">
          <mat-label>Modelo</mat-label>

          <input
            formControlName="modelo"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-error *ngIf="form.controls['modelo'].hasError('required')">
            El modelo es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>local_activity</mat-icon>
        </mat-form-field>
        <mat-form-field class="w-50">
          <mat-label>Cantidad</mat-label>
          <input formControlName="cantidad" matInput type="number" />
          <mat-error *ngIf="form.controls['cantidad'].hasError('required')">
            La cantidad es <strong> requerida </strong>
          </mat-error>
          <mat-icon matSuffix>plus_one</mat-icon>
        </mat-form-field>

        <mat-form-field class="w-50">
          <mat-label>Costo Unitario</mat-label>

          <input formControlName="costo_unitario" matInput type="number" />
          <mat-error
            *ngIf="form.controls['costo_unitario'].hasError('required')"
          >
            El costo unitario es <strong> requerido </strong>
          </mat-error>
          <mat-icon matSuffix>attach_money</mat-icon>
        </mat-form-field>
        <mat-form-field class="w-50">
          <mat-label>Total</mat-label>
          <input formControlName="total" matInput type="number" />
          <mat-error *ngIf="form.controls['total'].hasError('required')">
            El total es <strong> requerida </strong>
          </mat-error>
          <mat-icon matSuffix>monetization_on</mat-icon>
        </mat-form-field>

        <mat-form-field class="w-50">
          <mat-label>Fecha de Solicitud a Proveedor</mat-label>
          <input
            matInput
            [matDatepicker]="pickerProveedor"
            formControlName="fecha_proveedor"
            (dateChange)="onDateChange($event, 'fecha_proveedor')"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerProveedor"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerProveedor></mat-datepicker>
        </mat-form-field>

        <mat-form-field class="w-50">
          <mat-label>Estado Proveedor</mat-label>
          <mat-select formControlName="estado_proveedor" name="estado">
            <mat-option [value]="option.value" *ngFor="let option of statusP">{{
              option.value
            }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="w-50">
          <mat-label>Fecha de Terminado Proveedor</mat-label>
          <input
            matInput
            [matDatepicker]="pickerTerminado"
            formControlName="fecha_resuelto_proveedor"
            (dateChange)="onDateChange($event, 'fecha_resuelto_proveedor')"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerTerminado"
          ></mat-datepicker-toggle>
          <mat-datepicker #pickerTerminado></mat-datepicker>
        </mat-form-field>
        <mat-form-field class="w-50">
          <mat-label>Autorizó</mat-label>
          <input
            formControlName="autorizo"
            oninput="this.value = this.value.toUpperCase()"
            matInput
            type="text"
          />
          <mat-icon matSuffix>bookmark</mat-icon>
        </mat-form-field>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-3">
      <mat-form-field class="w-50">
        <mat-label>Fecha de Resuelto Cliente</mat-label>
        <input
          matInput
          [matDatepicker]="pickerCliente"
          formControlName="fecha_resuelto_cliente"
          (dateChange)="onDateChange($event, 'fecha_resuelto_cliente')"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="pickerCliente"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerCliente></mat-datepicker>
      </mat-form-field>
      <mat-form-field class="w-50">
        <mat-label>Estado Cliente</mat-label>
        <mat-select formControlName="estado_cliente" name="estado_cliente">
          <mat-option [value]="option.value" *ngFor="let option of statusC">{{
            option.value
          }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="grid grid-rows-1">
      <mat-form-field>
        <mat-label>Motivo</mat-label>
        <textarea
          oninput="this.value = this.value.toUpperCase()"
          matInput
          formControlName="motivo"
        ></textarea>
      </mat-form-field>
    </div>
    <p *ngIf="isUpdateMode()">Ultima modificacion: {{ data.modificador }}</p>

  </div>


  <div mat-dialog-actions align="end">

  
      <button mat-button (click)="onNoClick()">Cancelar</button>
      <button
        matButton="filled"
        *ngIf="isCreateMode()"
        [disabled]="form.invalid"
        (click)="onAdd()"
      >
        Agregar
      </button>
      <button
        matButton="filled"
        *ngIf="isUpdateMode()"
        [disabled]="form.invalid"
        (click)="onAdd()"
      >
        Actualizar
      </button>
  </div>
</form>
